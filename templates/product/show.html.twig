{% extends 'base.html.twig' %}

{% block title %}{{ product.name }} - LilyShop{% endblock %}

{% block body %}
<div class="container my-4">

  <!-- üñºÔ∏è Image produit -->
<div class="col-md-5 text-center">
  <img 
    src="{{ absolute_url(asset('uploads/images/' ~ product.image)) }}"
    alt="{{ product.name }}"
    class="img-fluid rounded shadow-sm mb-3"
    style="max-height: 400px; object-fit: contain;"
  >

  {# üîç Lien temporaire pour v√©rifier que Symfony g√©n√®re bien le bon chemin #}
  <p style="color:red; font-size: 0.9rem;">
    {{ absolute_url(asset('uploads/images/' ~ product.image)) }}
  </p>
</div>


    <!-- ‚ÑπÔ∏è D√©tails produit -->
    <div class="col-md-7">
      <h2 class="mb-3">{{ product.name }}</h2>
      <p class="text-muted">{{ product.description }}</p>

      <h3 class="text-success fw-bold">
        {{ product.price|number_format(2, '.', ',') }} ‚Ç¨
      </h3>

      <!-- üõí Bouton ajouter au panier -->
      <a href="{{ path('app_cart_add', {'id': product.id}) }}" 
         class="btn btn-success btn-lg mt-3">
        üõí Ajouter au panier
      </a>
    </div>
  </div>

  <hr class="my-4">

  <!-- ‚≠ê Avis des clients -->
  <h3>‚≠ê Avis des clients</h3>

  {% if reviews is not empty %}
      {% for review in reviews %}
          <div class="card mb-3">
              <div class="card-body">
                  <strong>{{ review.user.firstName }} {{ review.user.lastName }}</strong>
                  <span class="text-warning">
                      {% for i in 1..review.rating %}
                          ‚≠ê
                      {% endfor %}
                  </span>
                  <p class="mt-2">{{ review.content }}</p>
                  <small class="text-muted">
                    Publi√© le {{ review.createdAt|date('d/m/Y H:i') }}
                  </small>
              </div>
          </div>
      {% endfor %}
  {% else %}
      <p class="text-muted">Aucun avis pour ce produit. Soyez le premier √† en √©crire un !</p>
  {% endif %}

  {% if is_granted('ROLE_USER') %}
    <hr class="my-4">

    <!-- üìù Formulaire d'avis -->
    <div class="card shadow-sm p-4">
        <h4 class="mb-3">‚úçÔ∏è Donnez votre avis</h4>
            {{ form_start(reviewForm) }}
            {{ form_row(reviewForm.rating) }}
            {{ form_row(reviewForm.content) }}

            <button type="submit" class="btn btn-primary mt-3">
                ‚úÖ Publier mon avis
            </button>
             {{ form_end(reviewForm) }}
    </div>
    {% else %}
        <p class="mt-3">
        <a href="{{ path('app_login') }}" class="btn btn-outline-primary">
          üîë Connectez-vous pour r√©diger un avis
        </a>
        </p>
{% endif %}

  <hr class="my-4">

  <!-- üÜï Derniers produits ajout√©s -->
  <h3>üÜï Derniers produits ajout√©s</h3>
  <div class="row">
      {% for lastProduct in lastProducts %}
          <div class="col-md-3 mb-3">
              <div class="card h-100 shadow-sm">
                  <img src="{{ asset('uploads/' ~ lastProduct.image) }}" 
                       class="card-img-top" 
                       alt="{{ lastProduct.name }}">
                  <div class="card-body d-flex flex-column">
                      <h6 class="card-title">{{ lastProduct.name }}</h6>
                      <p class="text-success fw-bold">
                        {{ lastProduct.price|number_format(2, '.', ',') }} ‚Ç¨
                      </p>
                      <div class="mt-auto">
                          <a href="{{ path('app_home_product_show', {'id': lastProduct.id}) }}" 
                             class="btn btn-outline-success btn-sm w-100">
                              üëÄ Voir
                          </a>
                      </div>
                  </div>
              </div>
          </div>
      {% endfor %}
  </div>
</div>
{% endblock %}

